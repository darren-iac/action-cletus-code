{% set verdict_icon = "âœ…" if verdict == "Approved" else "âŒ" %}
{% set risk_icon_map = {'LOW': 'ðŸŸ¢', 'MEDIUM': 'ðŸŸ ', 'HIGH': 'ðŸ”´', 'CRITICAL': 'ðŸ”´'} %}

## ðŸ” Code Review

**Decision:** {{ verdict_icon }} {{ verdict }}

**Summary:** {{ summary }}

**Risk Level:** {{ overall_risk }}

{% if automerged is defined %}
**Automerge:** {{ "Yes - PR was automatically merged" if automerged else "No - PR left for manual review" }}
{% elif automation_note %}
**Automerge:** {{ automation_note }}
{% endif %}

{% if validation_errors %}
> âš ï¸ **Schema validation failed.** The structured review did not conform to expectations. Please address the issues below and rerun the workflow.
>{% for error in validation_errors %}
> â€¢ {{ error }}
>{% endfor %}

{% endif %}
{% if finding_groups %}

### Key Findings

{% set global_counter = namespace(value=1) %}
{% for group in finding_groups %}
{% for finding in group.findings %}
{{ global_counter.value }}. **[{{ finding.risk }}]** {{ finding.title }}
   - {{ finding.summary }}
{% set global_counter.value = global_counter.value + 1 %}
{% endfor %}
{% endfor %}
{% else %}
_No findings recorded._
{% endif %}

{% if validation_errors %}
### Next Steps
- Investigate the schema validation findings above.
- Update the structured review JSON and rerun this workflow before merging.
{% elif not finding_groups %}
### No Functional Changes
The diff contains no functional alterations. Cosmetic updates only.
{% endif %}

---

*Review generated by Cletus Code Review*

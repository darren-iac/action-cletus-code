{% set verdict_icon = "‚úÖ" if verdict == "Approved" else "üöß" %}
{% set risk_icon_map = {'LOW': 'üü¢', 'MEDIUM': 'üü†', 'HIGH': 'üî¥'} %}
{% set risk_icon = risk_icon_map.get(overall_risk, '‚ùì') %}

# üöÄ {{ headline }}

**{{ verdict_icon }} Verdict:** {{ verdict }}  
**{{ risk_icon }} Overall risk:** {{ overall_risk }}
{% if automation_note %}
**ü§ñ Automation:** {{ automation_note }}
{% endif %}

{% if validation_errors %}
> ‚ö†Ô∏è **Schema validation failed.** The structured review did not conform to expectations. Please address the issues below and rerun the workflow.
>{% for error in validation_errors %}
> ‚Ä¢ {{ error }}
>{% endfor %}

{% endif %}
{% if summary and summary != headline %}
## ‚úçÔ∏è Summary
{{ summary }}

{% endif %}
{% if finding_groups %}
## üîç Findings Overview
{% for group in finding_groups %}### {{ group.type | title }} ({{ group.findings | length }})
{% for finding in group.findings %}- [{{ finding.title }}](#{{ finding.anchor }}) ‚Ä¢ Risk: `{{ finding.risk }}`{% if finding.cosmetic %} _(cosmetic)_ {% endif %}
{% endfor %}

{% endfor %}
{% endif %}
## üß≠ Findings
{% if finding_groups %}
{% for group in finding_groups %}### {{ group.type | title }}
{% for finding in group.findings %}<a id="{{ finding.anchor }}"></a>
{% if finding.collapse %}<details>
<summary>{{ risk_icon_map.get(finding.risk, '‚ùì') }} **{{ finding.title }}**{% if finding.cosmetic %} _(cosmetic)_ {% endif %} ‚Äî Risk: `{{ finding.risk }}`</summary>

- Summary: {{ finding.summary }}
{% if finding.tags %}- Tags: `{% for tag in finding.tags %}{{ tag }}{% if not loop.last %}`, `{% endif %}{% endfor %}`
{% endif %}{% if finding.subject %}- Subject: {% if finding.subject.kind %}{{ finding.subject.kind }}{% if finding.subject.name %} ‚Äî {{ finding.subject.name }}{% endif %}{% elif finding.subject.name %}{{ finding.subject.name }}{% endif %}{% if finding.subject.from or finding.subject.to %} (`{{ finding.subject.from or 'n/a' }}` ‚Üí `{{ finding.subject.to or 'n/a' }}`){% endif %}
{% endif %}{% if finding.location %}- Location:{% if finding.location.resource %} {{ finding.location.resource }}{% endif %}{% if finding.location.path %}{% if finding.location.resource %} ‚Ä¢{% endif %} {{ finding.location.path }}{% if finding.location.line %}:{{ finding.location.line }}{% if finding.location.column %}:{{ finding.location.column }}{% endif %}{% endif %}{% endif %}
{% endif %}{% if finding.diff %}- Diff:
    ```diff
{% for line in finding.diff %}    {{ line }}
{% endfor %}    ```
{% endif %}{% if finding.snippet %}- Snippet:
    ```text
{% for line in finding.snippet %}    {{ line }}
{% endfor %}    ```
{% endif %}{% if finding.yaml %}- YAML:
    ```yaml
{% for line in finding.yaml %}    {{ line }}
{% endfor %}    ```
{% endif %}{% if finding.references %}
- References:
{% for ref in finding.references %}  - {% if ref.note %}{{ ref.note }}{% if ref.url %} ({{ ref.url }}){% endif %}{% else %}{{ ref.url }}{% endif %}
{% endfor %}{% endif %}

</details>

{% else %}- {{ risk_icon_map.get(finding.risk, '‚ùì') }} **{{ finding.title }}**{% if finding.cosmetic %} _(cosmetic)_ {% endif %}
  - Risk: `{{ finding.risk }}`{% if finding.tags %} ‚Ä¢ Tags: `{% for tag in finding.tags %}{{ tag }}{% if not loop.last %}`, `{% endif %}{% endfor %}`{% endif %}
  - Summary: {{ finding.summary }}
{% if finding.subject %}  - Subject: {% if finding.subject.kind %}{{ finding.subject.kind }}{% if finding.subject.name %} ‚Äî {{ finding.subject.name }}{% endif %}{% elif finding.subject.name %}{{ finding.subject.name }}{% endif %}{% if finding.subject.from or finding.subject.to %} (`{{ finding.subject.from or 'n/a' }}` ‚Üí `{{ finding.subject.to or 'n/a' }}`){% endif %}
{% endif %}{% if finding.location %}  - Location:{% if finding.location.resource %} {{ finding.location.resource }}{% endif %}{% if finding.location.path %}{% if finding.location.resource %} ‚Ä¢{% endif %} {{ finding.location.path }}{% if finding.location.line %}:{{ finding.location.line }}{% if finding.location.column %}:{{ finding.location.column }}{% endif %}{% endif %}{% endif %}
{% endif %}{% if finding.diff %}  - Diff:
    ```diff
{% for line in finding.diff %}    {{ line }}
{% endfor %}    ```
{% endif %}{% if finding.snippet %}  - Snippet:
    ```text
{% for line in finding.snippet %}    {{ line }}
{% endfor %}    ```
{% endif %}{% if finding.yaml %}  - YAML:
    ```yaml
{% for line in finding.yaml %}    {{ line }}
{% endfor %}    ```
{% endif %}{% if finding.references %}  - References:
{% for ref in finding.references %}    - {% if ref.note %}{{ ref.note }}{% if ref.url %} ({{ ref.url }}){% endif %}{% else %}{{ ref.url }}{% endif %}
{% endfor %}{% endif %}

{% endif %}{% endfor %}
{% endfor %}
{% else %}_No findings recorded._
{% endif %}

{% if validation_errors %}
## üßπ Next steps
- Investigate the schema validation findings above.
- Update the structured review JSON and rerun this workflow before merging.
{% elif not finding_groups %}
## üí§ No functional changes detected
The diff contains no functional alterations. Cosmetic updates only.
{% endif %}
